"use strict";var Model=function(e){var t="function"==typeof e._toObject?e._toObject():e;for(var n in Object.defineProperty(this,"_",{enumerable:!1,configurable:!1,writable:!1,value:{dt:t,ev:{},df:{},sp:!1,ct:0}}),this._.dt)this._addProperty(n)};Model.prototype._isObject=function(e){return"[object Object]"===Object.prototype.toString.call(e)},Model.prototype._clone=function(e){var t;if(Array.isArray(e)){t=[];for(var n=0,o=e.length;n<o;n++)t.push(e[n])}else if(this._isObject(e))for(var r in t={},e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t},Model.prototype._toObject=function(){return this._clone(this._.dt)},Model.prototype._suspend=function(){this._.sp=!0,this._.ct=0},Model.prototype._resume=function(){var e=this;if(e._.sp=!1,0<e._.ct){e._.ct=0;var t,n,o=[];for(var r in e._.dt)if(e._.dt.hasOwnProperty(r)&&Array.isArray(e._.ev[r]))for(t=0,n=e._.ev[r].length;t<n;t++)-1===o.indexOf(e._.ev[r][t])&&o.push(e._.ev[r][t]);for(t=0,n=o.length;t<n;t++)"function"==typeof o[t]&&o[t].call(e,e._.df)}},Model.prototype._delta=function(){return this._clone(this._.df)},Model.prototype._reset=function(){this._.df={}},Model.prototype._revert=function(e){var t=this,n=function(e){t._.df[e]&&(t[e]=t._.df[e].original)};if("string"==typeof e)n(e);else if(Array.isArray(e))for(var o=0,r=e.length;o<r;o++)n(e[o]);else if(void 0===e)for(var i in t._.dt)t._.dt.hasOwnProperty(i)&&n(i)},Model.prototype._changed=function(e){var n=this,o=n._delta(),t=!1,r=function(e){var t=!1;return o[e]&&o[e].original!==n[e]&&(t=!0),t};if("string"==typeof e)t=r(e);else if(Array.isArray(e)){for(var i=0,l=e.length;i<l;i++)if(r(e[i])&&!1===t){t=!0;break}}else if(void 0===e)for(var f in o)if(o.hasOwnProperty(f)){t=!0;break}return t},Model.prototype._watch=function(){var e,t,n,o,r,i=this,l={};if(0<arguments.length){if(1===arguments.length?"function"==typeof arguments[0]?t=arguments[0]:i._isObject(arguments[0])&&(e=arguments[0]):2<=arguments.length&&(e=arguments[0],t=arguments[1]),"string"==typeof e&&"function"==typeof t){var f=e.split(" ");for(o=0,r=f.length;o<r;o++)l[f[o]]=t}else if(Array.isArray(e)&&"function"==typeof t)for(o=0,r=e.length;o<r;o++)l[e[o]]=t;else if(i._isObject(e))l=e;else if("function"==typeof t)for(n in i._.dt)i._.dt.hasOwnProperty(n)&&!i._isObject(i._.dt[n])&&(l[n]=t);for(n in l)l.hasOwnProperty(n)&&(i._.ev[n]&&-1===i._.ev[n].indexOf(t)?i._.ev[n].push(l[n]):i._.ev[n]=[l[n]])}},Model.prototype._unwatch=function(){var e,n,t,o,r,i=this,l=function(e){if("function"==typeof n&&Array.isArray(i._.ev[e])){var t=i._.ev[e].indexOf(n);-1<t&&(i._.ev[e]=i._.ev[e].splice(t,1))}else i._.ev[e]=null,delete i._.ev[e]};if(0<arguments.length)if(1===arguments.length?"function"==typeof arguments[0]?n=arguments[0]:i._isObject(arguments[0])&&(e=arguments[0]):2<=arguments.length&&(e=arguments[0],n=arguments[1]),"string"==typeof e){var f=e.split(" ");for(o=0,r=f.length;o<r;o++)l(f[o])}else if(Array.isArray(e))for(o=0,r=e.length;o<r;o++)l(e[o]);else if(i._isObject(e))for(t in e)e.hasOwnProperty(t)&&l(t);else for(t in i._.dt)i._.dt.hasOwnProperty(t)&&!i._isObject(i._.dt[t])&&l(t);else i._.ev={}},Model.prototype._addProperty=function(l){var f=this;f._.dt.hasOwnProperty(l)&&(f._isObject(f._.dt[l])?Object.defineProperty(this,l,{enumerable:!0,configurable:!0,writable:!0,value:f._.dt[l]}):Object.defineProperty(f,l,{configurable:!1,enumerable:!0,get:function(){var e=f._.dt[l];return"function"==typeof f[l+"Read"]&&(e=f[l+"Read"](e)),e},set:function(e){"function"==typeof f[l+"Write"]&&(e=f[l+"Write"](e));var t=f._.dt[l],n={};if(t!==e)if(f._.dt[l]=e,f._.df[l]=f._.df[l]||{original:t},f._.df[l].actual=e,f._.df[l].previous=t,f._.sp)f._.ct++;else if(Array.isArray(f._.ev[l])){for(var o in n[l]={},f._.df[l])f._.df[l].hasOwnProperty(o)&&(n[l][o]=f._.df[l][o]);(function(e,t){var n=!1;if(Array.isArray(e)&&Array.isArray(t)){if(n=e.length===t.length)for(var o=0,r=e.length;o<r;o++)if(-1===t.indexOf(e[o])){n=!1;break}}else n=e===t;return n})(f._.df[l].actual,f._.df[l].original)&&delete f._.df[l];for(var r=0,i=f._.ev[l].length;r<i;r++)"function"==typeof f._.ev[l][r]&&f._.ev[l][r].call(f._.ev[l][r],n)}}}))},Model.prototype._add=function(e,t){this._.dt[e]=t,this._addProperty(e)},"undefined"!=typeof module&&void 0!==module.exports?module.exports={Model:Model}:(window.bimo=window.bimo||{},window.bimo.Model=Model),window.bimo=window.bimo||{},window.bimo.Bind=function(e){var t,i,l,r,f,s,n,a,c,d,u=this,p={};for(t in"string"==typeof(e=e||{}).config&&(e.config={selector:e.config}),e.config=e.config||{},i=function(e,t,n){e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener(t,n)},l=function(e,t){var n,o,r;if(u.options&&(e.options.length=0,u.placeHolder&&((n=document.createElement("option")).value="",n.innerHTML=u.placeHolder,null!=t&&""!==t||(n.selected="selected"),n.disabled="disabled",e.appendChild(n)),o="function"==typeof u.options?u.options.call(u):u.options)){if(Array.isArray(o)){for(var i={},l=0,f=o.length;l<f;l++)i[o[l]]=o[l];o=i}for(r in o)o.hasOwnProperty(r)&&((n=document.createElement("option")).value=r,n.innerHTML=o[r],r===t&&(n.selected="selected"),e.appendChild(n))}},r=function(e,t,n){e.detachEvent?e.detachEvent("on"+t,n):e.removeEventListener(t,n)},f=function(e,t){var n=function(e){t.call(u,e)};return p[e]=n},s=function(e){return null==e},function(e){return"[object Object]"===Object.prototype.toString.call(e)},n=function(e){var t;if(null!==e)if(-1!==["SELECT","INPUT","TEXTAREA"].indexOf(e.nodeName)){var n=e.type.toLowerCase();t="checkbox"===n?e.checked:"file"===n?e.files:e[u.property]}else t=e.innerHTML;return"function"==typeof u.write&&(t=u.write.call(u,t,e)),t},a=function(e){if("function"==typeof u.read)u.read.call(u,e);else if(!s(u.elements)&&!s(e))for(var t=0,n=u.elements.length;t<n;t++)if(-1!==["SELECT","INPUT","TEXTAREA"].indexOf(u.elements[t].nodeName)){var o=u.elements[t].type.toLowerCase();"checkbox"===o?u.elements[t].checked!==e&&(u.elements[t].checked=e):"file"===o||u.elements[t][u.property]!==e&&(u.elements[t][u.property]=e)}else u.elements[t].innerHTML!==e&&(u.elements[t].innerHTML=e)},c=function(e){if(u.twoWay){var t=n(e.target);void 0!==t&&(u.model[u.key]=t)}},d=function(e){for(var t in e)e.hasOwnProperty(t)&&u.key===t&&a(u.model[t])},u.bind=function(e){var t,n,o;if(!s(u.elements)){for(t=0,n=u.elements.length,t=0;t<n;++t)"SELECT"===u.elements[t].nodeName&&l(u.elements[t],u.model[u.key]);a(u.model[u.key])}if(u.model._watch(u.key,d),u.twoWay&&!s(u.elements))for(t=0,n=u.elements.length,t=0;t<n;++t)i(u.elements[t],u.event,c);for(o in u.events)if(u.events.hasOwnProperty(o)&&"function"==typeof u.events[o]){var r=f(o,u.events[o]);for(t=0,n=u.elements.length,t=0;t<n;++t)i(u.elements[t],o,r)}"function"==typeof e&&e.call(u)},u.unbind=function(e){var t,n,o;if(u.model._unwatch(u.key,d),u.twoWay)for(t=0,n=u.elements.length;t<n;++t)r(u.elements[t],u.event,c);for(o in p)if(p.hasOwnProperty(o))for(t=0,n=u.elements.length;t<n;++t)r(u.elements[t],o,p[o]);"function"==typeof e&&e.call(u)},Object.defineProperty(u,"visible",{enumerable:!0,configurable:!0,get:function(){var e=!0;return s(u.elements)||s(u.elements[0])||(e="none"!==u.elements[0].style.display),e},set:function(e){for(var t=0,n=u.elements.length;t<n;t++)u.elements[t].style.display=e?u.display||"":"none"}}),Object.defineProperty(u,"disabled",{enumerable:!0,configurable:!0,get:function(){var e=!1;return s(u.elements)||s(u.elements[0])||(e=u.elements[0].disabled),e},set:function(e){for(var t=0,n=u.elements.length;t<n;t++)u.elements[t].disabled=e}}),Object.defineProperty(u,"readOnly",{enumerable:!0,configurable:!0,get:function(){var e=!1;return s(u.elements)||s(u.elements[0])||-1===["INPUT","TEXTAREA"].indexOf(u.elements[0].nodeName)||(e=u.elements[0].readOnly),e},set:function(e){for(var t=0,n=u.elements.length;t<n;t++)-1!==["INPUT","TEXTAREA"].indexOf(u.elements[t].nodeName)&&(u.elements[t].readOnly=e)}}),Object.defineProperty(u,"required",{enumerable:!0,configurable:!0,get:function(){var e=!1;return s(u.elements)||s(u.elements[0])||(e=u.elements[0].required),e},set:function(e){for(var t=0,n=u.elements.length;t<n;t++)u.elements[t].required=e}}),e)e.hasOwnProperty(t)&&"config"!==t&&(u[t]=e[t]);for(t in u.twoWay=void 0===u.twoWay?e.defaults.twoWay:u.twoWay,u.event=u.event||e.defaults.event,u.property=u.property||e.defaults.property,u.elements=e.config.elements||null,u.selector=e.config.selector||null,e.config)e.config.hasOwnProperty(t)&&(u[t]=e.config[t]);if(u.events=u.events||{},s(u.elements))if(s(u.selector))u.elements=null;else if(u.elements="string"==typeof u.selector?u.container.querySelectorAll(u.selector):u.selector,null===u.elements)throw new Error(['"',u.selector.toString(),'" element not found!'])},window.bimo.Binder=function(e){var s,a=this;s=function(e){var t=e;if(null==t)t=document;else if("string"==typeof e&&null===(t=document.querySelector(t)))throw new Error(['"',e,'" container selector not found!']);return t},a.container=s(e.container),a.model=e.model||{},a.binds={},a.run=function(t){var e,n=function(e){"function"==typeof e[t]&&e[t].call(e)};for(e in a.binds)if(a.binds.hasOwnProperty(e))if(Array.isArray(a.binds[e]))for(var o=0,r=a.binds[e].length;o<r;o++)n(a.binds[e][o]);else n(a.binds[e])},a.init=function(e,t,n,o){var r;if(e&&(a.container=s(e)),a.model=t,n)for(r in o=o||{twoWay:!0,event:"change",property:"value"},n)if(n.hasOwnProperty(r))if(!0===Array.isArray(n[r])){a.binds[r]=[];for(var i=0,l=n[r].length;i<l;i++){var f=new window.bimo.Bind({container:a.container,model:a.model,key:r,config:n[r][i],defaults:o});a.binds[r].push(f)}}else a.binds[r]=new window.bimo.Bind({container:a.container,model:a.model,key:r,config:n[r],defaults:o})},a.bind=function(e){a.run("bind"),"function"==typeof e&&e.call(a)},a.unbind=function(e){a.run("unbind"),"function"==typeof e&&e.call(a)},e.model&&e.config&&a.init(a.container,a.model,e.config,e.defaults)};