"use strict";var Model=function(e){for(var t in Object.defineProperty(this,"_",{enumerable:!1,configurable:!1,writable:!1,value:{dt:this._clone(e),ev:{},df:{},sp:!1,ct:0}}),this._.dt)this._addProperty(t)};Model.prototype._isObject=function(e){return"[object Object]"===Object.prototype.toString.call(e)},Model.prototype._clone=function(e){return JSON.parse(JSON.stringify(e))},Model.prototype._toObject=function(){return this._clone(this._.dt)},Model.prototype._suspend=function(){this._.sp=!0,this._.ct=0},Model.prototype._resume=function(){if(this._.sp=!1,this._.ct>0){this._.ct=0;var e,t,n=[];for(var o in this._.dt)if(this._.dt.hasOwnProperty(o)&&Array.isArray(this._.ev[o]))for(e=0,t=this._.ev[o].length;e<t;e++)-1===n.indexOf(this._.ev[o][e])&&n.push(this._.ev[o][e]);for(e=0,t=n.length;e<t;e++)"function"==typeof n[e]&&n[e].call(this,this._.df)}},Model.prototype._delta=function(){return this._clone(this._.df)},Model.prototype._reset=function(){this._.df={}},Model.prototype._revert=function(e){var t=this,revert=function(e){t._.df[e]&&(t[e]=t._.df[e].original)};if("string"==typeof e)revert(e);else if(Array.isArray(e))for(var n=0,o=e.length;n<o;n++)revert(e[n]);else if(void 0===e)for(var r in t._.dt)t._.dt.hasOwnProperty(r)&&revert(r)},Model.prototype._changed=function(e){var t=this,n=t._delta(),o=!1,changed=function(e){var o=!1;return n[e]&&n[e].original!==t[e]&&(o=!0),o};if("string"==typeof e)o=changed(e);else if(Array.isArray(e)){for(var r=0,i=e.length;r<i;r++)if(changed(e[r])&&!1===o){o=!0;break}}else if(void 0===e)for(var l in n)if(n.hasOwnProperty(l)){o=!0;break}return o},Model.prototype._watch=function _watch(){var e,t,n,o,r,i=this,l={};if(arguments.length>0){if(1===arguments.length?"function"==typeof arguments[0]?t=arguments[0]:i._isObject(arguments[0])&&(e=arguments[0]):arguments.length>=2&&(e=arguments[0],t=arguments[1]),"string"==typeof e&&"function"==typeof t){var f=e.split(" ");for(o=0,r=f.length;o<r;o++)l[f[o]]=t}else if(Array.isArray(e)&&"function"==typeof t)for(o=0,r=e.length;o<r;o++)l[e[o]]=t;else if(i._isObject(e))l=e;else if("function"==typeof t)for(n in i._.dt)i._.dt.hasOwnProperty(n)&&!i._isObject(i._.dt[n])&&(l[n]=t);for(n in l)l.hasOwnProperty(n)&&(i._.ev[n]&&-1===i._.ev[n].indexOf(t)?i._.ev[n].push(l[n]):i._.ev[n]=[l[n]])}},Model.prototype._unwatch=function _unwatch(){var e,t,n,o,r,i=this,l=function remove(e){if("function"==typeof t&&Array.isArray(i._.ev[e])){var n=i._.ev[e].indexOf(t);n>-1&&(i._.ev[e]=i._.ev[e].splice(n,1))}else i._.ev[e]=null,delete i._.ev[e]};if(arguments.length>0)if(1===arguments.length?"function"==typeof arguments[0]?t=arguments[0]:i._isObject(arguments[0])&&(e=arguments[0]):arguments.length>=2&&(e=arguments[0],t=arguments[1]),"string"==typeof e){var f=e.split(" ");for(o=0,r=f.length;o<r;o++)l(f[o])}else if(Array.isArray(e))for(o=0,r=e.length;o<r;o++)l(e[o]);else if(i._isObject(e))for(n in e)e.hasOwnProperty(n)&&l(n);else for(n in i._.dt)i._.dt.hasOwnProperty(n)&&!i._isObject(i._.dt[n])&&l(n);else i._.ev={}},Model.prototype._addProperty=function _addProperty(e){var t=this;t._.dt.hasOwnProperty(e)&&(t._isObject(t._.dt[e])?Object.defineProperty(this,e,{enumerable:!0,configurable:!0,writable:!0,value:t._.dt[e]}):Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:function(){var n=t._.dt[e];return"function"==typeof t[e+"Read"]&&(n=t[e+"Read"](n)),n},set:function(n){"function"==typeof t[e+"Write"]&&(n=t[e+"Write"](n));var o=t._.dt[e],r={};if(o!==n)if(t._.dt[e]=n,t._.df[e]=t._.df[e]||{original:o},t._.df[e].actual=n,t._.df[e].previous=o,t._.sp)t._.ct++;else if(Array.isArray(t._.ev[e])){for(var i in r[e]={},t._.df[e])t._.df[e].hasOwnProperty(i)&&(r[e][i]=t._.df[e][i]);(function isEqual(e,t){var n=!1;if(Array.isArray(e)&&Array.isArray(t)){if(n=e.length===t.length)for(var o=0,r=e.length;o<r;o++)if(-1===t.indexOf(e[o])){n=!1;break}}else n=e===t;return n})(t._.df[e].actual,t._.df[e].original)&&delete t._.df[e];for(var l=0,f=t._.ev[e].length;l<f;l++)"function"==typeof t._.ev[e][l]&&t._.ev[e][l].call(t._.ev[e][l],r)}}}))},Model.prototype._add=function _add(e,t){this._.dt[e]=t,this._addProperty(e)},Model.prototype._clear=function _clear(e){e=e||{};for(var t in this)this.hasOwnProperty(t)&&(e.hasOwnProperty(t)?this[t]=e[t]:Array.isArray(this[t])?this[t]=[]:"boolean"==typeof this[t]?this[t]=!1:"number"==typeof this[t]?this[t]=0:"string"==typeof this[t]&&(this[t]=""));this._.df={}},"undefined"!=typeof module&&void 0!==module.exports?module.exports={Model:Model}:(window.bimo=window.bimo||{},window.bimo.Model=Model),window.bimo=window.bimo||{},window.bimo.Bind=function(e){var t,n,o,r,i,l,f,s,a,d,c=this,u={};for(t in"string"==typeof(e=e||{}).config&&(e.config={selector:e.config}),e.config=e.config||{},n=function(e,t,n){e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener(t,n)},o=function(e,t){var n,o,r;if(c.options&&(e.options.length=0,c.placeHolder&&((n=document.createElement("option")).value="",n.innerHTML=c.placeHolder,null!=t&&""!==t||(n.selected="selected"),n.disabled="disabled",e.appendChild(n)),o="function"==typeof c.options?c.options.call(c):c.options)){if(Array.isArray(o)){for(var i={},l=0,f=o.length;l<f;l++)i[o[l]]=o[l];o=i}for(r in o)o.hasOwnProperty(r)&&((n=document.createElement("option")).value=r,n.innerHTML=o[r],r===t&&(n.selected="selected"),e.appendChild(n))}},r=function(e,t,n){e.detachEvent?e.detachEvent("on"+t,n):e.removeEventListener(t,n)},i=function(e,t){var result=function(e){t.call(c,e)};return u[e]=result,result},l=function(e){return null==e},f=function(e){var t;if(null!==e)if(-1!==["SELECT","INPUT","TEXTAREA"].indexOf(e.nodeName)){var n=e.type.toLowerCase();t="checkbox"===n?e.checked:"file"===n?e.files:"number"===n?Number(e[c.property]):"date"===n?new Date(e.value):"time"===n?e.value:"datetime-local"===n?new Date(e.value):e[c.property]}else t=e.innerHTML;return"function"==typeof c.write&&(t=c.write.call(c,t,e)),t},s=function(e){if("function"==typeof c.read)c.read.call(c,e);else if(!l(c.elements))for(var t=0,n=c.elements.length;t<n;t++)if(-1!==["SELECT","INPUT","TEXTAREA"].indexOf(c.elements[t].nodeName)){var o=c.elements[t].type.toLowerCase();l(e)?"checkbox"===o?c.elements[t].checked=!1:"file"===o||""!==c.elements[t][c.property]&&(c.elements[t][c.property]=""):"checkbox"===o?c.elements[t].checked!==e&&(c.elements[t].checked=e):"file"===o||("date"===o?"string"==typeof e?c.elements[t].value=e:e&&"function"==typeof e.toISOString&&(c.elements[t].value=e.toISOString().substr(0,10)):"time"===o?"string"==typeof e?c.elements[t].value=e:e&&"function"==typeof e.toISOString&&(c.elements[t].value=e.toISOString().substr(11,5)):"datetime-local"===o?"string"==typeof e?c.elements[t].value=e:e&&"function"==typeof e.toISOString&&(c.elements[t].value=e.toISOString()):c.elements[t][c.property]!==e&&(c.elements[t][c.property]=e))}else l(e)?""!==c.elements[t].innerHTML&&(c.elements[t].innerHTML=""):c.elements[t].innerHTML!==e&&(c.elements[t].innerHTML=e)},a=function(e){if(c.twoWay){var t=f(e.target);void 0!==t&&(c.model[c.key]=t)}},d=function(e){for(var t in e)e.hasOwnProperty(t)&&c.key===t&&s(c.model[t])},c.bind=function(e){var t,r,f;if(!l(c.elements)){for(t=0,r=c.elements.length,t=0;t<r;++t)"SELECT"===c.elements[t].nodeName&&o(c.elements[t],c.model[c.key]);s(c.model[c.key])}if(c.model._watch(c.key,d),c.twoWay&&!l(c.elements))for(t=0,r=c.elements.length,t=0;t<r;++t)n(c.elements[t],c.event,a);for(f in c.events)if(c.events.hasOwnProperty(f)&&"function"==typeof c.events[f]){var u=i(f,c.events[f]);for(t=0,r=c.elements.length,t=0;t<r;++t)n(c.elements[t],f,u)}"function"==typeof e&&e.call(c)},c.unbind=function(e){var t,n,o;if(c.model._unwatch(c.key,d),c.twoWay)for(t=0,n=c.elements.length;t<n;++t)r(c.elements[t],c.event,a);for(o in u)if(u.hasOwnProperty(o))for(t=0,n=c.elements.length;t<n;++t)r(c.elements[t],o,u[o]);"function"==typeof e&&e.call(c)},Object.defineProperty(c,"visible",{enumerable:!0,configurable:!0,get:function(){var e=!0;return l(c.elements)||l(c.elements[0])||(e="none"!==c.elements[0].style.display),e},set:function(e){for(var t=0,n=c.elements.length;t<n;t++)c.elements[t].style.display=e?c.display||"":"none"}}),Object.defineProperty(c,"disabled",{enumerable:!0,configurable:!0,get:function(){var e=!1;return l(c.elements)||l(c.elements[0])||(e=c.elements[0].disabled),e},set:function(e){for(var t=0,n=c.elements.length;t<n;t++)c.elements[t].disabled=e}}),Object.defineProperty(c,"readOnly",{enumerable:!0,configurable:!0,get:function(){var e=!1;return l(c.elements)||l(c.elements[0])||-1===["INPUT","TEXTAREA"].indexOf(c.elements[0].nodeName)||(e=c.elements[0].readOnly),e},set:function(e){for(var t=0,n=c.elements.length;t<n;t++)-1!==["INPUT","TEXTAREA"].indexOf(c.elements[t].nodeName)&&(c.elements[t].readOnly=e)}}),Object.defineProperty(c,"required",{enumerable:!0,configurable:!0,get:function(){var e=!1;return l(c.elements)||l(c.elements[0])||(e=c.elements[0].required),e},set:function(e){for(var t=0,n=c.elements.length;t<n;t++)c.elements[t].required=e}}),e)e.hasOwnProperty(t)&&"config"!==t&&(c[t]=e[t]);for(t in c.twoWay=void 0===c.twoWay?e.defaults.twoWay:c.twoWay,c.event=c.event||e.defaults.event,c.property=c.property||e.defaults.property,c.elements=e.config.elements||null,c.selector=e.config.selector||null,e.config)e.config.hasOwnProperty(t)&&(c[t]=e.config[t]);if(c.events=c.events||{},l(c.elements))if(l(c.selector))c.elements=null;else if(c.elements="string"==typeof c.selector?c.container.querySelectorAll(c.selector):c.selector,null===c.elements)throw new Error(['"',c.selector.toString(),'" element not found!'])},window.bimo.Binder=function(e){var t,n=this;t=function(e){var t=e;if(null==t)t=document;else if("string"==typeof e&&null===(t=document.querySelector(t)))throw new Error(['"',e,'" container selector not found!']);return t},n.container=t(e.container),n.model=e.model||{},n.binds={},n.run=function(e){var t,o=function execute(t){"function"==typeof t[e]&&t[e].call(t)};for(t in n.binds)if(n.binds.hasOwnProperty(t))if(Array.isArray(n.binds[t]))for(var r=0,i=n.binds[t].length;r<i;r++)o(n.binds[t][r]);else o(n.binds[t])},n.init=function(e,o,r,i){var l;if(e&&(n.container=t(e)),n.model=o,r)for(l in i=i||{twoWay:!0,event:"change",property:"value"},r)if(r.hasOwnProperty(l))if(!0===Array.isArray(r[l])){n.binds[l]=[];for(var f=0,s=r[l].length;f<s;f++){var a=new window.bimo.Bind({container:n.container,model:n.model,key:l,config:r[l][f],defaults:i});n.binds[l].push(a)}}else n.binds[l]=new window.bimo.Bind({container:n.container,model:n.model,key:l,config:r[l],defaults:i})},n.bind=function(e){n.run("bind"),"function"==typeof e&&e.call(n)},n.unbind=function(e){n.run("unbind"),"function"==typeof e&&e.call(n)},e.model&&e.config&&n.init(n.container,n.model,e.config,e.defaults)};