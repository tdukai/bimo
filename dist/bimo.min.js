"use strict";var Model=function(e){for(var t in Object.defineProperty(this,"_",{enumerable:!1,configurable:!1,writable:!1,value:{dt:this._clone(e),ev:{},df:{},sp:!1,ct:0}}),this._.dt)this._addProperty(t)};Model.prototype._isObject=function(e){return"[object Object]"===Object.prototype.toString.call(e)},Model.prototype._clone=function(e){return JSON.parse(JSON.stringify(e))},Model.prototype._toObject=function(){return this._clone(this._.dt)},Model.prototype._suspend=function(){this._.sp=!0,this._.ct=0},Model.prototype._resume=function(){var e=this;if(e._.sp=!1,e._.ct>0){e._.ct=0;var t,n,r=[];for(var o in e._.dt)if(e._.dt.hasOwnProperty(o)&&Array.isArray(e._.ev[o]))for(t=0,n=e._.ev[o].length;t<n;t++)-1===r.indexOf(e._.ev[o][t])&&r.push(e._.ev[o][t]);for(t=0,n=r.length;t<n;t++)"function"==typeof r[t]&&r[t].call(e,e._.df)}},Model.prototype._delta=function(){return this._clone(this._.df)},Model.prototype._reset=function(){this._.df={}},Model.prototype._revert=function(e){var t=this,revert=function(e){t._.df[e]&&(t[e]=t._.df[e].original)};if("string"==typeof e)revert(e);else if(Array.isArray(e))for(var n=0,r=e.length;n<r;n++)revert(e[n]);else if(void 0===e)for(var o in t._.dt)t._.dt.hasOwnProperty(o)&&revert(o)},Model.prototype._changed=function(e){var t=this,n=t._delta(),r=!1,changed=function(e){var r=!1;return n[e]&&n[e].original!==t[e]&&(r=!0),r};if("string"==typeof e)r=changed(e);else if(Array.isArray(e)){for(var o=0,i=e.length;o<i;o++)if(changed(e[o])&&!1===r){r=!0;break}}else if(void 0===e)for(var l in n)if(n.hasOwnProperty(l)){r=!0;break}return r},Model.prototype._watch=function _watch(){var e,t,n,r,o,i=this,l={};if(arguments.length>0){if(1===arguments.length?"function"==typeof arguments[0]?t=arguments[0]:i._isObject(arguments[0])&&(e=arguments[0]):arguments.length>=2&&(e=arguments[0],t=arguments[1]),"string"==typeof e&&"function"==typeof t){var f=e.split(" ");for(r=0,o=f.length;r<o;r++)l[f[r]]=t}else if(Array.isArray(e)&&"function"==typeof t)for(r=0,o=e.length;r<o;r++)l[e[r]]=t;else if(i._isObject(e))l=e;else if("function"==typeof t)for(n in i._.dt)i._.dt.hasOwnProperty(n)&&!i._isObject(i._.dt[n])&&(l[n]=t);for(n in l)l.hasOwnProperty(n)&&(i._.ev[n]&&-1===i._.ev[n].indexOf(t)?i._.ev[n].push(l[n]):i._.ev[n]=[l[n]])}},Model.prototype._unwatch=function _unwatch(){var e,t,n,r,o,i=this,l=function remove(e){if("function"==typeof t&&Array.isArray(i._.ev[e])){var n=i._.ev[e].indexOf(t);n>-1&&(i._.ev[e]=i._.ev[e].splice(n,1))}else i._.ev[e]=null,delete i._.ev[e]};if(arguments.length>0)if(1===arguments.length?"function"==typeof arguments[0]?t=arguments[0]:i._isObject(arguments[0])&&(e=arguments[0]):arguments.length>=2&&(e=arguments[0],t=arguments[1]),"string"==typeof e){var f=e.split(" ");for(r=0,o=f.length;r<o;r++)l(f[r])}else if(Array.isArray(e))for(r=0,o=e.length;r<o;r++)l(e[r]);else if(i._isObject(e))for(n in e)e.hasOwnProperty(n)&&l(n);else for(n in i._.dt)i._.dt.hasOwnProperty(n)&&!i._isObject(i._.dt[n])&&l(n);else i._.ev={}},Model.prototype._addProperty=function _addProperty(e){var t=this;t._.dt.hasOwnProperty(e)&&(t._isObject(t._.dt[e])?Object.defineProperty(this,e,{enumerable:!0,configurable:!0,writable:!0,value:t._.dt[e]}):Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:function(){var n=t._.dt[e];return"function"==typeof t[e+"Read"]&&(n=t[e+"Read"](n)),n},set:function(n){"function"==typeof t[e+"Write"]&&(n=t[e+"Write"](n));var r=t._.dt[e],o={};if(r!==n)if(t._.dt[e]=n,t._.df[e]=t._.df[e]||{original:r},t._.df[e].actual=n,t._.df[e].previous=r,t._.sp)t._.ct++;else if(Array.isArray(t._.ev[e])){for(var i in o[e]={},t._.df[e])t._.df[e].hasOwnProperty(i)&&(o[e][i]=t._.df[e][i]);(function isEqual(e,t){var n=!1;if(Array.isArray(e)&&Array.isArray(t)){if(n=e.length===t.length)for(var r=0,o=e.length;r<o;r++)if(-1===t.indexOf(e[r])){n=!1;break}}else n=e===t;return n})(t._.df[e].actual,t._.df[e].original)&&delete t._.df[e];for(var l=0,f=t._.ev[e].length;l<f;l++)"function"==typeof t._.ev[e][l]&&t._.ev[e][l].call(t._.ev[e][l],o)}}}))},Model.prototype._refresh=function _refresh(e){var t=this,n={};for(var r in n[e]={refresh:!0},t._.df[e])t._.df[e].hasOwnProperty(r)&&(n[e][r]=t._.df[e][r]);for(var o=0,i=t._.ev[e].length;o<i;o++)"function"==typeof t._.ev[e][o]&&t._.ev[e][o].call(t._.ev[e][o],n)},Model.prototype._add=function _add(e,t){this._.dt[e]=t,this._addProperty(e)},Model.prototype._clear=function _clear(e){e=e||{};var t=this;for(var n in t)t.hasOwnProperty(n)&&(e.hasOwnProperty(n)?t[n]=e[n]:Array.isArray(t[n])?t[n]=[]:"boolean"==typeof t[n]?t[n]=!1:"number"==typeof t[n]?t[n]=0:"string"==typeof t[n]&&(t[n]=""));t._.df={}},"undefined"!=typeof module&&void 0!==module.exports?module.exports={Model:Model}:(window.bimo=window.bimo||{},window.bimo.Model=Model),window.bimo=window.bimo||{},window.bimo.Bind=function(e){var t,n,r,o,i,l,f,s,a,d,c=this,u={};for(t in"string"==typeof(e=e||{}).config&&(e.config={selector:e.config}),e.config=e.config||{},n=function(e,t,n){e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener(t,n)},r=function(e,t){var n,r,o;if(c.options&&(e.options.length=0,c.placeHolder&&((n=document.createElement("option")).value="",n.innerHTML=c.placeHolder,null!=t&&""!==t||(n.selected="selected"),n.disabled="disabled",e.appendChild(n)),r="function"==typeof c.options?c.options.call(c):c.options)){if(Array.isArray(r)){for(var i={},l=0,f=r.length;l<f;l++)i[r[l]]=r[l];r=i}for(o in r)r.hasOwnProperty(o)&&((n=document.createElement("option")).value=o,n.innerHTML=r[o],o===t&&(n.selected="selected"),e.appendChild(n))}},o=function(e,t,n){e.detachEvent?e.detachEvent("on"+t,n):e.removeEventListener(t,n)},i=function(e,t){var result=function(e){t.call(c,e)};return u[e]=result,result},l=function(e){return null==e},f=function(e){var t;if(null!==e)if(-1!==["SELECT","INPUT","TEXTAREA"].indexOf(e.nodeName)){var n=e.type.toLowerCase();t="checkbox"===n?e.checked:"file"===n?e.files:"number"===n?Number(e[c.property]):"date"===n?e.valueAsDate:"time"===n?e.value:"datetime-local"===n?e.valueAsDate:e[c.property]}else t=e.innerHTML;return"function"==typeof c.write&&(t=c.write.call(c,t,e)),t},s=function(e,t=!1){if("function"==typeof c.read)c.read.call(c,e);else if(!l(c.elements))for(var n=0,r=c.elements.length;n<r;n++)if(-1!==["SELECT","INPUT","TEXTAREA"].indexOf(c.elements[n].nodeName)){var o=c.elements[n].type.toLowerCase();l(e)?"checkbox"===o?c.elements[n].checked=!1:"file"===o||""!==c.elements[n][c.property]&&(c.elements[n][c.property]=""):"checkbox"===o?c.elements[n].checked===e&&!0!==t||(c.elements[n].checked=e):"file"===o||("date"===o?"string"==typeof e?c.elements[n].value=e.substr(0,10):e&&"function"==typeof e.toISOString&&(c.elements[n].value=e.toISOString().substr(0,10)):"time"===o?"string"==typeof e?c.elements[n].value=e.substr(11,5):e&&"function"==typeof e.toISOString&&(c.elements[n].value=e.toISOString().substr(11,5)):"datetime-local"===o?"string"==typeof e?c.elements[n].value=e.substr(0,16):e&&"function"==typeof e.toISOString&&(c.elements[n].value=e.toISOString().substr(0,16)):c.elements[n][c.property]===e&&!0!==t||(c.elements[n][c.property]=e))}else l(e)?""!==c.elements[n].innerHTML&&(c.elements[n].innerHTML=""):c.elements[n].innerHTML===e&&!0!==t||(c.elements[n].innerHTML=e)},a=function(e){if(c.twoWay){var t=f(e.target);void 0!==t&&(c.model[c.key]=t)}},d=function(e){for(var t in e)e.hasOwnProperty(t)&&c.key===t&&s(c.model[t],e.refresh)},c.bind=function(e){var t,o,f;if(!l(c.elements)){for(t=0,o=c.elements.length,t=0;t<o;++t)"SELECT"===c.elements[t].nodeName&&r(c.elements[t],c.model[c.key]);s(c.model[c.key])}if(c.model._watch(c.key,d),c.twoWay&&!l(c.elements))for(t=0,o=c.elements.length,t=0;t<o;++t)n(c.elements[t],c.event,a);for(f in c.events)if(c.events.hasOwnProperty(f)&&"function"==typeof c.events[f]){var u=i(f,c.events[f]);for(t=0,o=c.elements.length,t=0;t<o;++t)n(c.elements[t],f,u)}"function"==typeof e&&e.call(c)},c.unbind=function(e){var t,n,r;if(c.model._unwatch(c.key,d),c.twoWay)for(t=0,n=c.elements.length;t<n;++t)o(c.elements[t],c.event,a);for(r in u)if(u.hasOwnProperty(r))for(t=0,n=c.elements.length;t<n;++t)o(c.elements[t],r,u[r]);"function"==typeof e&&e.call(c)},Object.defineProperty(c,"visible",{enumerable:!0,configurable:!0,get:function(){var e=!0;return l(c.elements)||l(c.elements[0])||(e="none"!==c.elements[0].style.display),e},set:function(e){for(var t=0,n=c.elements.length;t<n;t++)c.elements[t].style.display=e?c.display||"":"none"}}),Object.defineProperty(c,"disabled",{enumerable:!0,configurable:!0,get:function(){var e=!1;return l(c.elements)||l(c.elements[0])||(e=c.elements[0].disabled),e},set:function(e){for(var t=0,n=c.elements.length;t<n;t++)c.elements[t].disabled=e}}),Object.defineProperty(c,"readOnly",{enumerable:!0,configurable:!0,get:function(){var e=!1;return l(c.elements)||l(c.elements[0])||-1===["INPUT","TEXTAREA"].indexOf(c.elements[0].nodeName)||(e=c.elements[0].readOnly),e},set:function(e){for(var t=0,n=c.elements.length;t<n;t++)-1!==["INPUT","TEXTAREA"].indexOf(c.elements[t].nodeName)&&(c.elements[t].readOnly=e)}}),Object.defineProperty(c,"required",{enumerable:!0,configurable:!0,get:function(){var e=!1;return l(c.elements)||l(c.elements[0])||(e=c.elements[0].required),e},set:function(e){for(var t=0,n=c.elements.length;t<n;t++)c.elements[t].required=e}}),e)e.hasOwnProperty(t)&&"config"!==t&&(c[t]=e[t]);for(t in c.twoWay=void 0===c.twoWay?e.defaults.twoWay:c.twoWay,c.event=c.event||e.defaults.event,c.property=c.property||e.defaults.property,c.elements=e.config.elements||null,c.selector=e.config.selector||null,e.config)e.config.hasOwnProperty(t)&&(c[t]=e.config[t]);if(c.events=c.events||{},l(c.elements))if(l(c.selector))c.elements=null;else if(c.elements="string"==typeof c.selector?c.container.querySelectorAll(c.selector):c.selector,null===c.elements)throw new Error(['"',c.selector.toString(),'" element not found!'])},window.bimo.Binder=function(e){var t,n=this;t=function(e){var t=e;if(null==t)t=document;else if("string"==typeof e&&null===(t=document.querySelector(t)))throw new Error(['"',e,'" container selector not found!']);return t},n.container=t(e.container),n.model=e.model||{},n.binds={},n.run=function(e){var t,r=function execute(t){"function"==typeof t[e]&&t[e].call(t)};for(t in n.binds)if(n.binds.hasOwnProperty(t))if(Array.isArray(n.binds[t]))for(var o=0,i=n.binds[t].length;o<i;o++)r(n.binds[t][o]);else r(n.binds[t])},n.init=function(e,r,o,i){var l;if(e&&(n.container=t(e)),n.model=r,o)for(l in i=i||{twoWay:!0,event:"change",property:"value"},o)if(o.hasOwnProperty(l))if(!0===Array.isArray(o[l])){n.binds[l]=[];for(var f=0,s=o[l].length;f<s;f++){var a=new window.bimo.Bind({container:n.container,model:n.model,key:l,config:o[l][f],defaults:i});n.binds[l].push(a)}}else n.binds[l]=new window.bimo.Bind({container:n.container,model:n.model,key:l,config:o[l],defaults:i})},n.bind=function(e){n.run("bind"),"function"==typeof e&&e.call(n)},n.unbind=function(e){n.run("unbind"),"function"==typeof e&&e.call(n)},e.model&&e.config&&n.init(n.container,n.model,e.config,e.defaults)};