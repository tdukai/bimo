"use strict";var Model=function(e){var n="function"==typeof e._toObject?e._toObject():e;for(var t in Object.defineProperty(this,"_",{enumerable:!1,configurable:!1,writable:!1,value:{dt:n,ev:{},df:{},sp:!1,ct:0}}),this._.dt)this._addProperty(t)};Model.prototype._isObject=function(e){return"[object Object]"===Object.prototype.toString.call(e)},Model.prototype._clone=function(e){var n;if(Array.isArray(e)){n=[];for(var t=0,r=e.length;t<r;t++)n.push(e[t])}else if(this._isObject(e))for(var o in n={},e)e.hasOwnProperty(o)&&(n[o]=e[o]);return n},Model.prototype._toObject=function(){return this._clone(this._.dt)},Model.prototype._suspend=function(){this._.sp=!0,this._.ct=0},Model.prototype._resume=function(){var e=this;if(e._.sp=!1,0<e._.ct){e._.ct=0;var n,t,r=[];for(var o in e._.dt)if(e._.dt.hasOwnProperty(o)&&Array.isArray(e._.ev[o]))for(n=0,t=e._.ev[o].length;n<t;n++)-1===r.indexOf(e._.ev[o][n])&&r.push(e._.ev[o][n]);for(n=0,t=r.length;n<t;n++)"function"==typeof r[n]&&r[n].call(e,e._.df)}},Model.prototype._delta=function(){return this._clone(this._.df)},Model.prototype._reset=function(){this._.df={}},Model.prototype._revert=function(e){var n=this,t=function(e){n._.df[e]&&(n[e]=n._.df[e].original)};if("string"==typeof e)t(e);else if(Array.isArray(e))for(var r=0,o=e.length;r<o;r++)t(e[r]);else if(void 0===e)for(var i in n._.dt)n._.dt.hasOwnProperty(i)&&t(i)},Model.prototype._changed=function(e){var t=this,r=t._delta(),n=!1,o=function(e){var n=!1;return r[e]&&r[e].original!==t[e]&&(n=!0),n};if("string"==typeof e)n=o(e);else if(Array.isArray(e)){for(var i=0,l=e.length;i<l;i++)if(o(e[i])&&!1===n){n=!0;break}}else if(void 0===e)for(var f in r)if(r.hasOwnProperty(f)){n=!0;break}return n},Model.prototype._watch=function(){var e,n,t,r,o,i=this,l={};if(0<arguments.length){if(1===arguments.length?"function"==typeof arguments[0]?n=arguments[0]:i._isObject(arguments[0])&&(e=arguments[0]):2<=arguments.length&&(e=arguments[0],n=arguments[1]),"string"==typeof e&&"function"==typeof n){var f=e.split(" ");for(r=0,o=f.length;r<o;r++)l[f[r]]=n}else if(Array.isArray(e)&&"function"==typeof n)for(r=0,o=e.length;r<o;r++)l[e[r]]=n;else if(i._isObject(e))l=e;else if("function"==typeof n)for(t in i._.dt)i._.dt.hasOwnProperty(t)&&!i._isObject(i._.dt[t])&&(l[t]=n);for(t in l)l.hasOwnProperty(t)&&(i._.ev[t]&&-1===i._.ev[t].indexOf(n)?i._.ev[t].push(l[t]):i._.ev[t]=[l[t]])}},Model.prototype._unwatch=function(){var e,t,n,r,o,i=this,l=function(e){if("function"==typeof t&&Array.isArray(i._.ev[e])){var n=i._.ev[e].indexOf(t);-1<n&&(i._.ev[e]=i._.ev[e].splice(n,1))}else i._.ev[e]=null,delete i._.ev[e]};if(0<arguments.length)if(1===arguments.length?"function"==typeof arguments[0]?t=arguments[0]:i._isObject(arguments[0])&&(e=arguments[0]):2<=arguments.length&&(e=arguments[0],t=arguments[1]),"string"==typeof e){var f=e.split(" ");for(r=0,o=f.length;r<o;r++)l(f[r])}else if(Array.isArray(e))for(r=0,o=e.length;r<o;r++)l(e[r]);else if(i._isObject(e))for(n in e)e.hasOwnProperty(n)&&l(n);else for(n in i._.dt)i._.dt.hasOwnProperty(n)&&!i._isObject(i._.dt[n])&&l(n);else i._.ev={}},Model.prototype._addProperty=function(l){var f=this;f._.dt.hasOwnProperty(l)&&(f._isObject(f._.dt[l])?Object.defineProperty(this,l,{enumerable:!0,configurable:!0,writable:!0,value:f._.dt[l]}):Object.defineProperty(f,l,{configurable:!1,enumerable:!0,get:function(){var e=f._.dt[l];return"function"==typeof f[l+"Read"]&&(e=f[l+"Read"](e)),e},set:function(e){"function"==typeof f[l+"Write"]&&(e=f[l+"Write"](e));var n=f._.dt[l],t={};if(n!==e)if(f._.dt[l]=e,f._.df[l]=f._.df[l]||{original:n},f._.df[l].actual=e,f._.df[l].previous=n,f._.sp)f._.ct++;else if(Array.isArray(f._.ev[l])){for(var r in t[l]={},f._.df[l])f._.df[l].hasOwnProperty(r)&&(t[l][r]=f._.df[l][r]);(function(e,n){var t=!1;if(Array.isArray(e)&&Array.isArray(n)){if(t=e.length===n.length)for(var r=0,o=e.length;r<o;r++)if(-1===n.indexOf(e[r])){t=!1;break}}else t=e===n;return t})(f._.df[l].actual,f._.df[l].original)&&delete f._.df[l];for(var o=0,i=f._.ev[l].length;o<i;o++)"function"==typeof f._.ev[l][o]&&f._.ev[l][o].call(f._.ev[l][o],t)}}}))},"undefined"!=typeof module&&void 0!==module.exports?module.exports={Model:Model}:(window.bimo=window.bimo||{},window.bimo.Model=Model),window.bimo=window.bimo||{},window.bimo.Bind=function(e){var n,i,l,o,f,s,t,a,c,d,u=this,p={};for(n in"string"==typeof(e=e||{}).config&&(e.config={selector:e.config}),e.config=e.config||{},i=function(e,n,t){e.attachEvent?e.attachEvent("on"+n,t):e.addEventListener(n,t)},l=function(e,n){var t,r,o;if(u.options&&(e.options.length=0,u.placeHolder&&((t=document.createElement("option")).value="",t.innerHTML=u.placeHolder,null!=n&&""!==n||(t.selected="selected"),t.disabled="disabled",e.appendChild(t)),r="function"==typeof u.options?u.options.call(u):u.options)){if(Array.isArray(r)){for(var i={},l=0,f=r.length;l<f;l++)i[r[l]]=r[l];r=i}for(o in r)r.hasOwnProperty(o)&&((t=document.createElement("option")).value=o,t.innerHTML=r[o],o===n&&(t.selected="selected"),e.appendChild(t))}},o=function(e,n,t){e.detachEvent?e.detachEvent("on"+n,t):e.removeEventListener(n,t)},f=function(e,n){var t=function(e){n.call(u,e)};return p[e]=t},s=function(e){return null==e},function(e){return"[object Object]"===Object.prototype.toString.call(e)},t=function(e){var n;return null!==e&&(n=-1!==["SELECT","INPUT","TEXTAREA"].indexOf(e.nodeName)?"CHECKBOX"===e.type.toUpperCase()?e.checked:e[u.property]:e.innerHTML),"function"==typeof u.write&&(n=u.write.call(u,n,e)),n},a=function(e){if("function"==typeof u.read)u.read.call(u,e);else if(!s(u.elements)&&!s(e))for(var n=0,t=u.elements.length;n<t;n++)-1!==["SELECT","INPUT","TEXTAREA"].indexOf(u.elements[n].nodeName)?"CHECKBOX"===u.elements[n].type.toUpperCase()?u.elements[n].checked!==e&&(u.elements[n].checked=e):u.elements[n][u.property]!==e&&(u.elements[n][u.property]=e):u.elements[n].innerHTML!==e&&(u.elements[n].innerHTML=e)},c=function(e){if(u.twoWay){var n=t(e.target);void 0!==n&&(u.model[u.key]=n)}},d=function(e){for(var n in e)e.hasOwnProperty(n)&&u.key===n&&a(u.model[n])},u.bind=function(e){var n,t,r;if(!s(u.elements)){for(n=0,t=u.elements.length,n=0;n<t;++n)"SELECT"===u.elements[n].nodeName&&l(u.elements[n],u.model[u.key]);a(u.model[u.key])}if(u.model._watch(u.key,d),u.twoWay&&!s(u.elements))for(n=0,t=u.elements.length,n=0;n<t;++n)i(u.elements[n],u.event,c);for(r in u.events)if(u.events.hasOwnProperty(r)&&"function"==typeof u.events[r]){var o=f(r,u.events[r]);for(n=0,t=u.elements.length,n=0;n<t;++n)i(u.elements[n],r,o)}"function"==typeof e&&e.call(u)},u.unbind=function(e){var n,t,r;if(u.model._unwatch(u.key,d),u.twoWay)for(n=0,t=u.elements.length;n<t;++n)o(u.elements[n],u.event,c);for(r in p)if(p.hasOwnProperty(r))for(n=0,t=u.elements.length;n<t;++n)o(u.elements[n],r,p[r]);"function"==typeof e&&e.call(u)},Object.defineProperty(u,"visible",{enumerable:!0,configurable:!0,get:function(){var e=!0;return s(u.elements)||s(u.elements[0])||(e="none"!==u.elements[0].style.display),e},set:function(e){for(var n=0,t=u.elements.length;n<t;n++)u.elements[n].style.display=e?u.display||"":"none"}}),Object.defineProperty(u,"disabled",{enumerable:!0,configurable:!0,get:function(){var e=!1;return s(u.elements)||s(u.elements[0])||(e=u.elements[0].disabled),e},set:function(e){for(var n=0,t=u.elements.length;n<t;n++)u.elements[n].disabled=e}}),Object.defineProperty(u,"readOnly",{enumerable:!0,configurable:!0,get:function(){var e=!1;return s(u.elements)||s(u.elements[0])||-1===["INPUT","TEXTAREA"].indexOf(u.elements[0].nodeName)||(e=u.elements[0].readOnly),e},set:function(e){for(var n=0,t=u.elements.length;n<t;n++)-1!==["INPUT","TEXTAREA"].indexOf(u.elements[n].nodeName)&&(u.elements[n].readOnly=e)}}),Object.defineProperty(u,"required",{enumerable:!0,configurable:!0,get:function(){var e=!1;return s(u.elements)||s(u.elements[0])||(e=u.elements[0].required),e},set:function(e){for(var n=0,t=u.elements.length;n<t;n++)u.elements[n].required=e}}),e)e.hasOwnProperty(n)&&"config"!==n&&(u[n]=e[n]);for(n in u.twoWay=void 0===u.twoWay?e.defaults.twoWay:u.twoWay,u.event=u.event||e.defaults.event,u.property=u.property||e.defaults.property,u.elements=e.config.elements||null,u.selector=e.config.selector||null,e.config)e.config.hasOwnProperty(n)&&(u[n]=e.config[n]);if(u.events=u.events||{},s(u.elements))if(s(u.selector))u.elements=null;else if(u.elements="string"==typeof u.selector?u.container.querySelectorAll(u.selector):u.selector,null===u.elements)throw new Error(['"',u.selector.toString(),'" element not found!'])},window.bimo.Binder=function(e){var s,a=this;s=function(e){var n=e;if(null==n)n=document;else if("string"==typeof e&&null===(n=document.querySelector(n)))throw new Error(['"',e,'" container selector not found!']);return n},a.container=s(e.container),a.model=e.model||{},a.binds={},a.run=function(n){var e,t=function(e){"function"==typeof e[n]&&e[n].call(e)};for(e in a.binds)if(a.binds.hasOwnProperty(e))if(Array.isArray(a.binds[e]))for(var r=0,o=a.binds[e].length;r<o;r++)t(a.binds[e][r]);else t(a.binds[e])},a.init=function(e,n,t,r){var o;if(e&&(a.container=s(e)),a.model=n,t)for(o in r=r||{twoWay:!0,event:"change",property:"value"},t)if(t.hasOwnProperty(o))if(!0===Array.isArray(t[o])){a.binds[o]=[];for(var i=0,l=t[o].length;i<l;i++){var f=new window.bimo.Bind({container:a.container,model:a.model,key:o,config:t[o][i],defaults:r});a.binds[o].push(f)}}else a.binds[o]=new window.bimo.Bind({container:a.container,model:a.model,key:o,config:t[o],defaults:r})},a.bind=function(e){a.run("bind"),"function"==typeof e&&e.call(a)},a.unbind=function(e){a.run("unbind"),"function"==typeof e&&e.call(a)},e.model&&e.config&&a.init(a.container,a.model,e.config,e.defaults)};