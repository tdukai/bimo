"use strict";var Model=function(e){for(var n in Object.defineProperty(this,"_",{enumerable:!1,configurable:!1,writable:!1,value:{dt:this._clone(e),ev:{},df:{},sp:!1,ct:0}}),this._.dt)this._addProperty(n)};Model.prototype._isObject=function(e){return"[object Object]"===Object.prototype.toString.call(e)},Model.prototype._clone=function(e){return JSON.parse(JSON.stringify(e))},Model.prototype._toObject=function(){return this._clone(this._.dt)},Model.prototype._suspend=function(){this._.sp=!0,this._.ct=0},Model.prototype._resume=function(){var e=this;if(e._.sp=!1,0<e._.ct){e._.ct=0;var n,t,o=[];for(var r in e._.dt)if(e._.dt.hasOwnProperty(r)&&Array.isArray(e._.ev[r]))for(n=0,t=e._.ev[r].length;n<t;n++)-1===o.indexOf(e._.ev[r][n])&&o.push(e._.ev[r][n]);for(n=0,t=o.length;n<t;n++)"function"==typeof o[n]&&o[n].call(e,e._.df)}},Model.prototype._delta=function(){return this._clone(this._.df)},Model.prototype._reset=function(){this._.df={}},Model.prototype._revert=function(e){function n(e){t._.df[e]&&(t[e]=t._.df[e].original)}var t=this;if("string"==typeof e)n(e);else if(Array.isArray(e))for(var o=0,r=e.length;o<r;o++)n(e[o]);else if(void 0===e)for(var i in t._.dt)t._.dt.hasOwnProperty(i)&&n(i)},Model.prototype._changed=function(e){function n(e){var n=!1;return o[e]&&o[e].original!==t[e]&&(n=!0),n}var t=this,o=t._delta(),r=!1;if("string"==typeof e)r=n(e);else if(Array.isArray(e)){for(var i=0,l=e.length;i<l;i++)if(n(e[i])&&!1===r){r=!0;break}}else if(void 0===e)for(var f in o)if(o.hasOwnProperty(f)){r=!0;break}return r},Model.prototype._watch=function(e,n){var t,o,r,i,l,f=this,s={};if(0<arguments.length){if(1===arguments.length?"function"==typeof e?o=e:f._isObject(e)&&(t=e):2<=arguments.length&&(t=e,o=n),"string"==typeof t&&"function"==typeof o){var a=t.split(" ");for(i=0,l=a.length;i<l;i++)s[a[i]]=o}else if(Array.isArray(t)&&"function"==typeof o)for(i=0,l=t.length;i<l;i++)s[t[i]]=o;else if(f._isObject(t))s=t;else if("function"==typeof o)for(r in f._.dt)f._.dt.hasOwnProperty(r)&&!f._isObject(f._.dt[r])&&(s[r]=o);for(r in s)s.hasOwnProperty(r)&&(f._.ev[r]&&-1===f._.ev[r].indexOf(o)?f._.ev[r].push(s[r]):f._.ev[r]=[s[r]])}},Model.prototype._unwatch=function(e,n){function t(e){if("function"==typeof r&&Array.isArray(s._.ev[e])){var n=s._.ev[e].indexOf(r);-1<n&&(s._.ev[e]=s._.ev[e].splice(n,1))}else s._.ev[e]=null,delete s._.ev[e]}var o,r,i,l,f,s=this;if(0<arguments.length)if(1===arguments.length?"function"==typeof e?r=e:s._isObject(e)&&(o=e):2<=arguments.length&&(o=e,r=n),"string"==typeof o){var a=o.split(" ");for(l=0,f=a.length;l<f;l++)t(a[l])}else if(Array.isArray(o))for(l=0,f=o.length;l<f;l++)t(o[l]);else if(s._isObject(o))for(i in o)o.hasOwnProperty(i)&&t(i);else for(i in s._.dt)s._.dt.hasOwnProperty(i)&&!s._isObject(s._.dt[i])&&t(i);else s._.ev={}},Model.prototype._addProperty=function(l){var f=this;f._.dt.hasOwnProperty(l)&&(f._isObject(f._.dt[l])?Object.defineProperty(this,l,{enumerable:!0,configurable:!0,writable:!0,value:f._.dt[l]}):Object.defineProperty(f,l,{configurable:!1,enumerable:!0,get:function(){var e=f._.dt[l];return"function"==typeof f[l+"Read"]&&(e=f[l+"Read"](e)),e},set:function(e){"function"==typeof f[l+"Write"]&&(e=f[l+"Write"](e));var n=f._.dt[l],t={};if(n!==e)if(f._.dt[l]=e,f._.df[l]=f._.df[l]||{original:n},f._.df[l].actual=e,f._.df[l].previous=n,f._.sp)f._.ct++;else if(Array.isArray(f._.ev[l])){for(var o in t[l]={},f._.df[l])f._.df[l].hasOwnProperty(o)&&(t[l][o]=f._.df[l][o]);!function(e,n){var t=!1;if(Array.isArray(e)&&Array.isArray(n)){if(t=e.length===n.length)for(var o=0,r=e.length;o<r;o++)if(-1===n.indexOf(e[o])){t=!1;break}}else t=e===n;return t}(f._.df[l].actual,f._.df[l].original)||delete f._.df[l];for(var r=0,i=f._.ev[l].length;r<i;r++)"function"==typeof f._.ev[l][r]&&f._.ev[l][r].call(f._.ev[l][r],t)}}}))},Model.prototype._add=function(e,n){this._.dt[e]=n,this._addProperty(e)},Model.prototype._clear=function(e){e=e||{};var n=this;for(var t in n)n.hasOwnProperty(t)&&(e.hasOwnProperty(t)?n[t]=e[t]:Array.isArray(n[t])?n[t]=[]:"boolean"==typeof n[t]?n[t]=!1:"number"==typeof n[t]?n[t]=0:n[t]=null);n._.df={}},"undefined"!=typeof module&&void 0!==module.exports?module.exports={Model:Model}:(window.bimo=window.bimo||{},window.bimo.Model=Model),window.bimo=window.bimo||{},window.bimo.Bind=function(e){var n,i,l,r,f,s,t,a,d,c,u=this,p={};for(n in"string"==typeof(e=e||{}).config&&(e.config={selector:e.config}),e.config=e.config||{},i=function(e,n,t){e.attachEvent?e.attachEvent("on"+n,t):e.addEventListener(n,t)},l=function(e,n){var t,o,r;if(u.options&&(e.options.length=0,u.placeHolder&&((t=document.createElement("option")).value="",t.innerHTML=u.placeHolder,null!=n&&""!==n||(t.selected="selected"),t.disabled="disabled",e.appendChild(t)),o="function"==typeof u.options?u.options.call(u):u.options)){if(Array.isArray(o)){for(var i={},l=0,f=o.length;l<f;l++)i[o[l]]=o[l];o=i}for(r in o)o.hasOwnProperty(r)&&((t=document.createElement("option")).value=r,t.innerHTML=o[r],r===n&&(t.selected="selected"),e.appendChild(t))}},r=function(e,n,t){e.detachEvent?e.detachEvent("on"+n,t):e.removeEventListener(n,t)},f=function(e,n){function t(e){n.call(u,e)}return p[e]=t},s=function(e){return null==e},function(e){return"[object Object]"===Object.prototype.toString.call(e)},t=function(e){var n;if(null!==e)if(-1!==["SELECT","INPUT","TEXTAREA"].indexOf(e.nodeName)){var t=e.type.toLowerCase();n="checkbox"===t?e.checked:"file"===t?e.files:e[u.property]}else n=e.innerHTML;return"function"==typeof u.write&&(n=u.write.call(u,n,e)),n},a=function(e){if("function"==typeof u.read)u.read.call(u,e);else if(!s(u.elements)&&!s(e))for(var n=0,t=u.elements.length;n<t;n++)if(-1!==["SELECT","INPUT","TEXTAREA"].indexOf(u.elements[n].nodeName)){var o=u.elements[n].type.toLowerCase();"checkbox"===o?u.elements[n].checked!==e&&(u.elements[n].checked=e):"file"===o||u.elements[n][u.property]!==e&&(u.elements[n][u.property]=e)}else u.elements[n].innerHTML!==e&&(u.elements[n].innerHTML=e)},d=function(e){if(u.twoWay){var n=t(e.target);void 0!==n&&(u.model[u.key]=n)}},c=function(e){for(var n in e)e.hasOwnProperty(n)&&u.key===n&&a(u.model[n])},u.bind=function(e){var n,t,o;if(!s(u.elements)){for(n=0,t=u.elements.length,n=0;n<t;++n)"SELECT"===u.elements[n].nodeName&&l(u.elements[n],u.model[u.key]);a(u.model[u.key])}if(u.model._watch(u.key,c),u.twoWay&&!s(u.elements))for(n=0,t=u.elements.length,n=0;n<t;++n)i(u.elements[n],u.event,d);for(o in u.events)if(u.events.hasOwnProperty(o)&&"function"==typeof u.events[o]){var r=f(o,u.events[o]);for(n=0,t=u.elements.length,n=0;n<t;++n)i(u.elements[n],o,r)}"function"==typeof e&&e.call(u)},u.unbind=function(e){var n,t,o;if(u.model._unwatch(u.key,c),u.twoWay)for(n=0,t=u.elements.length;n<t;++n)r(u.elements[n],u.event,d);for(o in p)if(p.hasOwnProperty(o))for(n=0,t=u.elements.length;n<t;++n)r(u.elements[n],o,p[o]);"function"==typeof e&&e.call(u)},Object.defineProperty(u,"visible",{enumerable:!0,configurable:!0,get:function(){var e=!0;return s(u.elements)||s(u.elements[0])||(e="none"!==u.elements[0].style.display),e},set:function(e){for(var n=0,t=u.elements.length;n<t;n++)u.elements[n].style.display=e?u.display||"":"none"}}),Object.defineProperty(u,"disabled",{enumerable:!0,configurable:!0,get:function(){var e=!1;return s(u.elements)||s(u.elements[0])||(e=u.elements[0].disabled),e},set:function(e){for(var n=0,t=u.elements.length;n<t;n++)u.elements[n].disabled=e}}),Object.defineProperty(u,"readOnly",{enumerable:!0,configurable:!0,get:function(){var e=!1;return s(u.elements)||s(u.elements[0])||-1===["INPUT","TEXTAREA"].indexOf(u.elements[0].nodeName)||(e=u.elements[0].readOnly),e},set:function(e){for(var n=0,t=u.elements.length;n<t;n++)-1!==["INPUT","TEXTAREA"].indexOf(u.elements[n].nodeName)&&(u.elements[n].readOnly=e)}}),Object.defineProperty(u,"required",{enumerable:!0,configurable:!0,get:function(){var e=!1;return s(u.elements)||s(u.elements[0])||(e=u.elements[0].required),e},set:function(e){for(var n=0,t=u.elements.length;n<t;n++)u.elements[n].required=e}}),e)e.hasOwnProperty(n)&&"config"!==n&&(u[n]=e[n]);for(n in u.twoWay=void 0===u.twoWay?e.defaults.twoWay:u.twoWay,u.event=u.event||e.defaults.event,u.property=u.property||e.defaults.property,u.elements=e.config.elements||null,u.selector=e.config.selector||null,e.config)e.config.hasOwnProperty(n)&&(u[n]=e.config[n]);if(u.events=u.events||{},s(u.elements))if(s(u.selector))u.elements=null;else if(u.elements="string"==typeof u.selector?u.container.querySelectorAll(u.selector):u.selector,null===u.elements)throw new Error(['"',u.selector.toString(),'" element not found!'])},window.bimo.Binder=function(e){var s,a=this;s=function(e){var n=e;if(null==n)n=document;else if("string"==typeof e&&null===(n=document.querySelector(n)))throw new Error(['"',e,'" container selector not found!']);return n},a.container=s(e.container),a.model=e.model||{},a.binds={},a.run=function(n){function e(e){"function"==typeof e[n]&&e[n].call(e)}var t;for(t in a.binds)if(a.binds.hasOwnProperty(t))if(Array.isArray(a.binds[t]))for(var o=0,r=a.binds[t].length;o<r;o++)e(a.binds[t][o]);else e(a.binds[t])},a.init=function(e,n,t,o){var r;if(e&&(a.container=s(e)),a.model=n,t)for(r in o=o||{twoWay:!0,event:"change",property:"value"},t)if(t.hasOwnProperty(r))if(!0===Array.isArray(t[r])){a.binds[r]=[];for(var i=0,l=t[r].length;i<l;i++){var f=new window.bimo.Bind({container:a.container,model:a.model,key:r,config:t[r][i],defaults:o});a.binds[r].push(f)}}else a.binds[r]=new window.bimo.Bind({container:a.container,model:a.model,key:r,config:t[r],defaults:o})},a.bind=function(e){a.run("bind"),"function"==typeof e&&e.call(a)},a.unbind=function(e){a.run("unbind"),"function"==typeof e&&e.call(a)},e.model&&e.config&&a.init(a.container,a.model,e.config,e.defaults)};