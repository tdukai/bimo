"use strict";var Model=function(e){for(var t in Object.defineProperty(this,"_",{enumerable:!1,configurable:!1,writable:!1,value:{dt:this._clone(e),ev:{},df:{},sp:!1,ct:0}}),this._.dt)this._addProperty(t)};Model.prototype._isObject=function(e){return"[object Object]"===Object.prototype.toString.call(e)},Model.prototype._clone=function(e){return JSON.parse(JSON.stringify(e))},Model.prototype._toObject=function(){return this._clone(this._.dt)},Model.prototype._suspend=function(){this._.sp=!0,this._.ct=0},Model.prototype._resume=function(){var e=this;if(e._.sp=!1,0<e._.ct){e._.ct=0;var t,r,o=[];for(var i in e._.dt)if(e._.dt.hasOwnProperty(i)&&Array.isArray(e._.ev[i]))for(t=0,r=e._.ev[i].length;t<r;t++)-1===o.indexOf(e._.ev[i][t])&&o.push(e._.ev[i][t]);for(t=0,r=o.length;t<r;t++)"function"==typeof o[t]&&o[t].call(e,e._.df)}},Model.prototype._delta=function(){return this._clone(this._.df)},Model.prototype._reset=function(){this._.df={}},Model.prototype._revert=function(e){function t(e){r._.df[e]&&(r[e]=r._.df[e].original)}var r=this;if("string"==typeof e)t(e);else if(Array.isArray(e))for(var o=0,i=e.length;o<i;o++)t(e[o]);else if(void 0===e)for(var n in r._.dt)r._.dt.hasOwnProperty(n)&&t(n)},Model.prototype._changed=function(e){function t(e){var t=!1;return o[e]&&o[e].original!==r[e]&&(t=!0),t}var r=this,o=r._delta(),i=!1;if("string"==typeof e)i=t(e);else if(Array.isArray(e)){for(var n=0,f=e.length;n<f;n++)if(t(e[n])&&!1===i){i=!0;break}}else if(void 0===e)for(var a in o)if(o.hasOwnProperty(a)){i=!0;break}return i},Model.prototype._watch=function(e,t){var r,o,i,n,f,a=this,l={};if(0<arguments.length){if(1===arguments.length?"function"==typeof e?o=e:a._isObject(e)&&(r=e):2<=arguments.length&&(r=e,o=t),"string"==typeof r&&"function"==typeof o){var d=r.split(" ");for(n=0,f=d.length;n<f;n++)l[d[n]]=o}else if(Array.isArray(r)&&"function"==typeof o)for(n=0,f=r.length;n<f;n++)l[r[n]]=o;else if(a._isObject(r))l=r;else if("function"==typeof o)for(i in a._.dt)a._.dt.hasOwnProperty(i)&&!a._isObject(a._.dt[i])&&(l[i]=o);for(i in l)l.hasOwnProperty(i)&&(a._.ev[i]&&-1===a._.ev[i].indexOf(o)?a._.ev[i].push(l[i]):a._.ev[i]=[l[i]])}},Model.prototype._unwatch=function(e,t){function r(e){if("function"==typeof i&&Array.isArray(l._.ev[e])){var t=l._.ev[e].indexOf(i);-1<t&&(l._.ev[e]=l._.ev[e].splice(t,1))}else l._.ev[e]=null,delete l._.ev[e]}var o,i,n,f,a,l=this;if(0<arguments.length)if(1===arguments.length?"function"==typeof e?i=e:l._isObject(e)&&(o=e):2<=arguments.length&&(o=e,i=t),"string"==typeof o){var d=o.split(" ");for(f=0,a=d.length;f<a;f++)r(d[f])}else if(Array.isArray(o))for(f=0,a=o.length;f<a;f++)r(o[f]);else if(l._isObject(o))for(n in o)o.hasOwnProperty(n)&&r(n);else for(n in l._.dt)l._.dt.hasOwnProperty(n)&&!l._isObject(l._.dt[n])&&r(n);else l._.ev={}},Model.prototype._addProperty=function(f){var a=this;a._.dt.hasOwnProperty(f)&&(a._isObject(a._.dt[f])?Object.defineProperty(this,f,{enumerable:!0,configurable:!0,writable:!0,value:a._.dt[f]}):Object.defineProperty(a,f,{configurable:!1,enumerable:!0,get:function(){var e=a._.dt[f];return"function"==typeof a[f+"Read"]&&(e=a[f+"Read"](e)),e},set:function(e){"function"==typeof a[f+"Write"]&&(e=a[f+"Write"](e));var t=a._.dt[f],r={};if(t!==e)if(a._.dt[f]=e,a._.df[f]=a._.df[f]||{original:t},a._.df[f].actual=e,a._.df[f].previous=t,a._.sp)a._.ct++;else if(Array.isArray(a._.ev[f])){for(var o in r[f]={},a._.df[f])a._.df[f].hasOwnProperty(o)&&(r[f][o]=a._.df[f][o]);!function(e,t){var r=!1;if(Array.isArray(e)&&Array.isArray(t)){if(r=e.length===t.length)for(var o=0,i=e.length;o<i;o++)if(-1===t.indexOf(e[o])){r=!1;break}}else r=e===t;return r}(a._.df[f].actual,a._.df[f].original)||delete a._.df[f];for(var i=0,n=a._.ev[f].length;i<n;i++)"function"==typeof a._.ev[f][i]&&a._.ev[f][i].call(a._.ev[f][i],r)}}}))},Model.prototype._add=function(e,t){this._.dt[e]=t,this._addProperty(e)},Model.prototype._clear=function(e){e=e||{};var t=this;for(var r in t)t.hasOwnProperty(r)&&(e.hasOwnProperty(r)?t[r]=e[r]:Array.isArray(t[r])?t[r]=[]:"boolean"==typeof t[r]?t[r]=!1:"number"==typeof t[r]?t[r]=0:t[r]=null);t._.df={}},"undefined"!=typeof module&&void 0!==module.exports?module.exports={Model:Model}:(window.bimo=window.bimo||{},window.bimo.Model=Model);