"use strict";var Model=function(t){for(var e in Object.defineProperty(this,"_",{enumerable:!1,configurable:!1,writable:!1,value:{dt:this._clone(t),ev:{},df:{},sp:!1,ct:0}}),this._.dt)this._addProperty(e)};Model.prototype._isObject=function(t){return"[object Object]"===Object.prototype.toString.call(t)},Model.prototype._clone=function(t){return JSON.parse(JSON.stringify(t))},Model.prototype._toObject=function(){return this._clone(this._.dt)},Model.prototype._suspend=function(){this._.sp=!0,this._.ct=0},Model.prototype._resume=function(){if(this._.sp=!1,this._.ct>0){this._.ct=0;var t,e,r=[];for(var i in this._.dt)if(this._.dt.hasOwnProperty(i)&&Array.isArray(this._.ev[i]))for(t=0,e=this._.ev[i].length;t<e;t++)-1===r.indexOf(this._.ev[i][t])&&r.push(this._.ev[i][t]);for(t=0,e=r.length;t<e;t++)"function"==typeof r[t]&&r[t].call(this,this._.df)}},Model.prototype._delta=function(){return this._clone(this._.df)},Model.prototype._reset=function(){this._.df={}},Model.prototype._revert=function(t){var e=this,revert=function(t){e._.df[t]&&(e[t]=e._.df[t].original)};if("string"==typeof t)revert(t);else if(Array.isArray(t))for(var r=0,i=t.length;r<i;r++)revert(t[r]);else if(void 0===t)for(var o in e._.dt)e._.dt.hasOwnProperty(o)&&revert(o)},Model.prototype._changed=function(t){var e=this,r=e._delta(),i=!1,changed=function(t){var i=!1;return r[t]&&r[t].original!==e[t]&&(i=!0),i};if("string"==typeof t)i=changed(t);else if(Array.isArray(t)){for(var o=0,n=t.length;o<n;o++)if(changed(t[o])&&!1===i){i=!0;break}}else if(void 0===t)for(var f in r)if(r.hasOwnProperty(f)){i=!0;break}return i},Model.prototype._watch=function _watch(){var t,e,r,i,o,n=this,f={};if(arguments.length>0){if(1===arguments.length?"function"==typeof arguments[0]?e=arguments[0]:n._isObject(arguments[0])&&(t=arguments[0]):arguments.length>=2&&(t=arguments[0],e=arguments[1]),"string"==typeof t&&"function"==typeof e){var s=t.split(" ");for(i=0,o=s.length;i<o;i++)f[s[i]]=e}else if(Array.isArray(t)&&"function"==typeof e)for(i=0,o=t.length;i<o;i++)f[t[i]]=e;else if(n._isObject(t))f=t;else if("function"==typeof e)for(r in n._.dt)n._.dt.hasOwnProperty(r)&&!n._isObject(n._.dt[r])&&(f[r]=e);for(r in f)f.hasOwnProperty(r)&&(n._.ev[r]&&-1===n._.ev[r].indexOf(e)?n._.ev[r].push(f[r]):n._.ev[r]=[f[r]])}},Model.prototype._unwatch=function _unwatch(){var t,e,r,i,o,n=this,f=function remove(t){if("function"==typeof e&&Array.isArray(n._.ev[t])){var r=n._.ev[t].indexOf(e);r>-1&&(n._.ev[t]=n._.ev[t].splice(r,1))}else n._.ev[t]=null,delete n._.ev[t]};if(arguments.length>0)if(1===arguments.length?"function"==typeof arguments[0]?e=arguments[0]:n._isObject(arguments[0])&&(t=arguments[0]):arguments.length>=2&&(t=arguments[0],e=arguments[1]),"string"==typeof t){var s=t.split(" ");for(i=0,o=s.length;i<o;i++)f(s[i])}else if(Array.isArray(t))for(i=0,o=t.length;i<o;i++)f(t[i]);else if(n._isObject(t))for(r in t)t.hasOwnProperty(r)&&f(r);else for(r in n._.dt)n._.dt.hasOwnProperty(r)&&!n._isObject(n._.dt[r])&&f(r);else n._.ev={}},Model.prototype._addProperty=function _addProperty(t){var e=this;e._.dt.hasOwnProperty(t)&&(e._isObject(e._.dt[t])?Object.defineProperty(this,t,{enumerable:!0,configurable:!0,writable:!0,value:e._.dt[t]}):Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:function(){var r=e._.dt[t];return"function"==typeof e[t+"Read"]&&(r=e[t+"Read"](r)),r},set:function(r){"function"==typeof e[t+"Write"]&&(r=e[t+"Write"](r));var i=e._.dt[t],o={};if(i!==r)if(e._.dt[t]=r,e._.df[t]=e._.df[t]||{original:i},e._.df[t].actual=r,e._.df[t].previous=i,e._.sp)e._.ct++;else if(Array.isArray(e._.ev[t])){for(var n in o[t]={},e._.df[t])e._.df[t].hasOwnProperty(n)&&(o[t][n]=e._.df[t][n]);(function isEqual(t,e){var r=!1;if(Array.isArray(t)&&Array.isArray(e)){if(r=t.length===e.length)for(var i=0,o=t.length;i<o;i++)if(-1===e.indexOf(t[i])){r=!1;break}}else r=t===e;return r})(e._.df[t].actual,e._.df[t].original)&&delete e._.df[t];for(var f=0,s=e._.ev[t].length;f<s;f++)"function"==typeof e._.ev[t][f]&&e._.ev[t][f].call(e._.ev[t][f],o)}}}))},Model.prototype._add=function _add(t,e){this._.dt[t]=e,this._addProperty(t)},Model.prototype._clear=function _clear(t){t=t||{};for(var e in this)this.hasOwnProperty(e)&&(t.hasOwnProperty(e)?this[e]=t[e]:Array.isArray(this[e])?this[e]=[]:"boolean"==typeof this[e]?this[e]=!1:"number"==typeof this[e]?this[e]=0:"string"==typeof this[e]&&(this[e]=""));this._.df={}},"undefined"!=typeof module&&void 0!==module.exports?module.exports={Model:Model}:(window.bimo=window.bimo||{},window.bimo.Model=Model);