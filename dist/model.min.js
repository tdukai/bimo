"use strict";var Model=function(e){for(var t in Object.defineProperty(this,"_",{enumerable:!1,configurable:!1,writable:!1,value:{dt:this._clone(e),ev:{},df:{},sp:!1,ct:0}}),this._.dt)this._addProperty(t)};Model.prototype._isObject=function(e){return"[object Object]"===Object.prototype.toString.call(e)},Model.prototype._clone=function(e){return JSON.parse(JSON.stringify(e))},Model.prototype._toObject=function(){return this._clone(this._.dt)},Model.prototype._suspend=function(){this._.sp=!0,this._.ct=0},Model.prototype._resume=function(){var e=this;if(e._.sp=!1,e._.ct>0){e._.ct=0;var t,r,o=[];for(var i in e._.dt)if(e._.dt.hasOwnProperty(i)&&Array.isArray(e._.ev[i]))for(t=0,r=e._.ev[i].length;t<r;t++)-1===o.indexOf(e._.ev[i][t])&&o.push(e._.ev[i][t]);for(t=0,r=o.length;t<r;t++)"function"==typeof o[t]&&o[t].call(e,e._.df)}},Model.prototype._delta=function(){return this._clone(this._.df)},Model.prototype._reset=function(){this._.df={}},Model.prototype._revert=function(e){var t=this,revert=function(e){t._.df[e]&&(t[e]=t._.df[e].original)};if("string"==typeof e)revert(e);else if(Array.isArray(e))for(var r=0,o=e.length;r<o;r++)revert(e[r]);else if(void 0===e)for(var i in t._.dt)t._.dt.hasOwnProperty(i)&&revert(i)},Model.prototype._changed=function(e){var t=this,r=t._delta(),o=!1,changed=function(e){var o=!1;return r[e]&&r[e].original!==t[e]&&(o=!0),o};if("string"==typeof e)o=changed(e);else if(Array.isArray(e)){for(var i=0,n=e.length;i<n;i++)if(changed(e[i])&&!1===o){o=!0;break}}else if(void 0===e)for(var f in r)if(r.hasOwnProperty(f)){o=!0;break}return o},Model.prototype._watch=function _watch(){var e,t,r,o,i,n=this,f={};if(arguments.length>0){if(1===arguments.length?"function"==typeof arguments[0]?t=arguments[0]:n._isObject(arguments[0])&&(e=arguments[0]):arguments.length>=2&&(e=arguments[0],t=arguments[1]),"string"==typeof e&&"function"==typeof t){var a=e.split(" ");for(o=0,i=a.length;o<i;o++)f[a[o]]=t}else if(Array.isArray(e)&&"function"==typeof t)for(o=0,i=e.length;o<i;o++)f[e[o]]=t;else if(n._isObject(e))f=e;else if("function"==typeof t)for(r in n._.dt)n._.dt.hasOwnProperty(r)&&!n._isObject(n._.dt[r])&&(f[r]=t);for(r in f)f.hasOwnProperty(r)&&(n._.ev[r]&&-1===n._.ev[r].indexOf(t)?n._.ev[r].push(f[r]):n._.ev[r]=[f[r]])}},Model.prototype._unwatch=function _unwatch(){var e,t,r,o,i,n=this,f=function remove(e){if("function"==typeof t&&Array.isArray(n._.ev[e])){var r=n._.ev[e].indexOf(t);r>-1&&(n._.ev[e]=n._.ev[e].splice(r,1))}else n._.ev[e]=null,delete n._.ev[e]};if(arguments.length>0)if(1===arguments.length?"function"==typeof arguments[0]?t=arguments[0]:n._isObject(arguments[0])&&(e=arguments[0]):arguments.length>=2&&(e=arguments[0],t=arguments[1]),"string"==typeof e){var a=e.split(" ");for(o=0,i=a.length;o<i;o++)f(a[o])}else if(Array.isArray(e))for(o=0,i=e.length;o<i;o++)f(e[o]);else if(n._isObject(e))for(r in e)e.hasOwnProperty(r)&&f(r);else for(r in n._.dt)n._.dt.hasOwnProperty(r)&&!n._isObject(n._.dt[r])&&f(r);else n._.ev={}},Model.prototype._addProperty=function _addProperty(e){var t=this;t._.dt.hasOwnProperty(e)&&(t._isObject(t._.dt[e])?Object.defineProperty(this,e,{enumerable:!0,configurable:!0,writable:!0,value:t._.dt[e]}):Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:function(){var r=t._.dt[e];return"function"==typeof t[e+"Read"]&&(r=t[e+"Read"](r)),r},set:function(r){"function"==typeof t[e+"Write"]&&(r=t[e+"Write"](r));var o=t._.dt[e],i={};if(o!==r)if(t._.dt[e]=r,t._.df[e]=t._.df[e]||{original:o},t._.df[e].actual=r,t._.df[e].previous=o,t._.sp)t._.ct++;else if(Array.isArray(t._.ev[e])){for(var n in i[e]={},t._.df[e])t._.df[e].hasOwnProperty(n)&&(i[e][n]=t._.df[e][n]);(function isEqual(e,t){var r=!1;if(Array.isArray(e)&&Array.isArray(t)){if(r=e.length===t.length)for(var o=0,i=e.length;o<i;o++)if(-1===t.indexOf(e[o])){r=!1;break}}else r=e===t;return r})(t._.df[e].actual,t._.df[e].original)&&delete t._.df[e];for(var f=0,a=t._.ev[e].length;f<a;f++)"function"==typeof t._.ev[e][f]&&t._.ev[e][f].call(t._.ev[e][f],i)}}}))},Model.prototype._add=function _add(e,t){this._.dt[e]=t,this._addProperty(e)},Model.prototype._clear=function _clear(e){e=e||{};var t=this;for(var r in t)t.hasOwnProperty(r)&&(e.hasOwnProperty(r)?t[r]=e[r]:Array.isArray(t[r])?t[r]=[]:"boolean"==typeof t[r]?t[r]=!1:"number"==typeof t[r]?t[r]=0:"string"==typeof t[r]&&(t[r]=""));t._.df={}},"undefined"!=typeof module&&void 0!==module.exports?module.exports={Model:Model}:(window.bimo=window.bimo||{},window.bimo.Model=Model);