"use strict";class Bind{constructor(e={}){if(Object.assign(this,e),this.controlHandler=e=>{this.controlChanged(e)},this.modelHandler=e=>{this.modelChanged(e)},this.handlers={},this.events=this.events||{},this.elements=this.elements||null,this.selector=this.selector||null,this.isEmpty(this.elements))if(this.isEmpty(this.selector))this.elements=null;else if(this.elements="string"==typeof this.selector?this.container.querySelectorAll(this.selector):this.selector,null===this.elements)throw new Error(['"',this.selector.toString(),'" element not found!'])}get visible(){let e=!0;return this.isEmpty(this.elements)||this.isEmpty(this.elements[0])||(e="none"!==this.elements[0].style.display),e}set visible(e){for(const t of this.elements)t.style.display=e?this.display||"":"none"}get disabled(){let e=!1;return this.isEmpty(this.elements)||this.isEmpty(this.elements[0])||(e=this.elements[0].disabled),e}set disabled(e){for(const t of this.elements)t.disabled=e}get readOnly(){let e=!1;return this.isEmpty(this.elements)||this.isEmpty(this.elements[0])||["INPUT","TEXTAREA"].includes(this.elements[0].nodeName)||(e=this.elements[0].readOnly),e}set readOnly(e){for(const t of this.elements)["INPUT","TEXTAREA"].includes(t.nodeName)||(t.readOnly=e)}get required(){let e=!1;return this.isEmpty(this.elements)||this.isEmpty(this.elements[0])||(e=this.elements[0].required),e}set required(e){for(const t of this.elements)t.required=e}addEvent(e,t,s){e.attachEvent?e.attachEvent("on"+t,s):e.addEventListener(t,s)}addOptions(e,t){let s,i;if(this.options&&(e.options.length=0,this.placeHolder&&(s=document.createElement("option"),s.value="",s.innerHTML=this.placeHolder,null!=t&&""!==t||(s.selected="selected"),s.disabled="disabled",e.appendChild(s)),i="function"==typeof this.options?this.options(this):this.options,i)){if(Array.isArray(i)){var n={};for(const e of i)n[e]=e;i=n}const o=Object.keys(i);for(const n of o)s=document.createElement("option"),s.value=n,s.innerHTML=i[n],n===t&&(s.selected="selected"),e.appendChild(s)}}removeEvent(e,t,s){e.detachEvent?e.detachEvent("on"+t,s):e.removeEventListener(t,s)}customEvent(e,t){const s=e=>{t(this,e)};return this.handlers[e]=s,s}isEmpty(e){return null==e}getValue(e){let t;if(null!==e)if(["SELECT","INPUT","TEXTAREA"].includes(e.nodeName)){var s=e.type.toLowerCase();t="checkbox"===s?e.checked:"file"===s?e.files:"number"===s?Number(e[this.property]):"date"===s?e.valueAsDate:"time"===s?e.value:"datetime-local"===s?e.valueAsDate:e[this.property]}else t=e.innerHTML;return"function"==typeof this.write&&(t=this.write({value:t,elements:this.elements,target:e,binding:this})),t}setValue(e,t=!1){const s={value:e,elements:this.elements,binding:this};if("function"==typeof this.read)this.read(s);else if(!this.isEmpty(this.elements)){"function"==typeof this.format&&(e=this.format(s));for(const s of this.elements)if(["SELECT","INPUT","TEXTAREA"].includes(s.nodeName)){const i=s.type.toLowerCase();this.isEmpty(e)?"checkbox"===i?s.checked=!1:"file"===i||""!==s[this.property]&&(s[this.property]=""):"checkbox"===i?s.checked===e&&!0!==t||(s.checked=e):"file"===i||("date"===i?"string"==typeof e?s.value=e.substr(0,10):e&&"function"==typeof e.toISOString&&(s.value=e.toISOString().substr(0,10)):"time"===i?"string"==typeof e?s.value=e.substr(11,5):e&&"function"==typeof e.toISOString&&(s.value=e.toISOString().substr(11,5)):"datetime-local"===i?"string"==typeof e?s.value=e.substr(0,16):e&&"function"==typeof e.toISOString&&(s.value=e.toISOString().substr(0,16)):s[this.property]===e&&!0!==t||(s[this.property]=e))}else this.isEmpty(e)?""!==s.innerHTML&&(s.innerHTML=""):s.innerHTML===e&&!0!==t||(s.innerHTML=e)}}controlChanged(e){if(!0===this.twoWay){const t=this.getValue(e.target);void 0!==t&&(this.model[this.key]=t)}}modelChanged(e){const t=Object.keys(e);for(const s of t)this.key===s&&this.setValue(this.model[s],e.refresh)}apply(e,t){if(!0===e){if(!this.isEmpty(this.elements)){for(const e of this.elements)"SELECT"===e.nodeName&&this.addOptions(e,this.model[this.key]);this.setValue(this.model[this.key])}if(this.model._watch(this.key,this.modelHandler),!0===this.twoWay&&!this.isEmpty(this.elements))for(const e of this.elements)this.addEvent(e,this.event,this.controlHandler);const e=Object.keys(this.events);for(const t of e)if("function"==typeof this.events[t]){const e=this.customEvent(t,this.events[t]);for(const s of this.elements)this.addEvent(s,t,e)}"function"==typeof t&&t.call(this)}else{if(this.model._unwatch(this.key,this.modelHandler),!0===this.twoWay)for(const e of this.elements)this.removeEvent(e,this.event,this.controlHandler);const e=Object.keys(this.handlers);for(const t of e)for(const e of this.elements)this.removeEvent(e,t,this.handlers[t]);"function"==typeof t&&t(this)}}}window.bimo=window.bimo||{},window.bimo.Bind=Bind;class Binder{constructor(e={}){this.container=this.getContainer(e.container),this.model=e.model||{},this.binds={},this.init(this.container,this.model,e.config,e.defaults)}init(e,t,s={},i={twoWay:!0,event:"change",property:"value"}){e&&(this.container=this.getContainer(e)),this.model=t;const n=Object.keys(s);for(const e of n)if(!0===Array.isArray(s[e])){this.binds[e]=[];for(const t of s[e]){const s=Object.assign({},i,t,{container:this.container,model:this.model._model(e),key:this.model._property(e)}),n=new window.bimo.Bind(s);this.binds[e].push(n)}}else{const t="string"==typeof s[e]?{selector:s[e]}:s[e],n=Object.assign({},i,t,{container:this.container,model:this.model._model(e),key:this.model._property(e)});this.binds[e]=new window.bimo.Bind(n)}}getContainer(e){let t=e;if(null==t)t=document;else if("string"==typeof e&&(t=document.querySelector(t),null===t))throw new Error(['"',e,'" container selector not found!']);return t}bind(e){const t=Object.keys(this.binds);for(const e of t)try{if(Array.isArray(this.binds[e]))for(const t of this.binds[e])t.apply(!0);else this.binds[e].apply(!0)}catch(t){console.error(e,t)}"function"==typeof e&&e.call(this)}unbind(e){const t=Object.keys(this.binds);for(const e of t)try{if(Array.isArray(this.binds[e]))for(const t of this.binds[e])t.apply(!1);else this.binds[e].apply(!1)}catch(t){console.error(e,t)}"function"==typeof e&&e.call(this)}}window.bimo.Binder=Binder;