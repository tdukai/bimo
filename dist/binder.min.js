"use strict";class Bind{constructor(t={}){"string"==typeof t.config&&(t.config={selector:t.config}),t.config=t.config||{},this.handlers={};const e=Object.keys(t);for(const s of e)"config"!==s&&(this[s]=t[s]);this.twoWay=void 0===this.twoWay?t.defaults.twoWay:this.twoWay,this.event=this.event||t.defaults.event,this.property=this.property||t.defaults.property,this.elements=t.config.elements||null,this.selector=t.config.selector||null,this.controlHandler=t=>{this.controlChanged(t)},this.modelHandler=t=>{this.modelChanged(t)};const s=Object.keys(t.config);for(const e of s)this[e]=t.config[e];if(this.events=this.events||{},this.isEmpty(this.elements))if(this.isEmpty(this.selector))this.elements=null;else if(this.elements="string"==typeof this.selector?this.container.querySelectorAll(this.selector):this.selector,null===this.elements)throw new Error(['"',this.selector.toString(),'" element not found!'])}get visible(){let t=!0;return this.isEmpty(this.elements)||this.isEmpty(this.elements[0])||(t="none"!==this.elements[0].style.display),t}set visible(t){for(const e of this.elements)e.style.display=t?this.display||"":"none"}get disabled(){let t=!1;return this.isEmpty(this.elements)||this.isEmpty(this.elements[0])||(t=this.elements[0].disabled),t}set disabled(t){for(const e of this.elements)e.disabled=t}get readOnly(){let t=!1;return this.isEmpty(this.elements)||this.isEmpty(this.elements[0])||["INPUT","TEXTAREA"].includes(this.elements[0].nodeName)||(t=this.elements[0].readOnly),t}set readOnly(t){for(const e of this.elements)["INPUT","TEXTAREA"].includes(e.nodeName)||(e.readOnly=t)}get required(){let t=!1;return this.isEmpty(this.elements)||this.isEmpty(this.elements[0])||(t=this.elements[0].required),t}set required(t){for(const e of this.elements)e.required=t}addEvent(t,e,s){t.attachEvent?t.attachEvent("on"+e,s):t.addEventListener(e,s)}addOptions(t,e){let s,i;if(this.options&&(t.options.length=0,this.placeHolder&&(s=document.createElement("option"),s.value="",s.innerHTML=this.placeHolder,null!=e&&""!==e||(s.selected="selected"),s.disabled="disabled",t.appendChild(s)),i="function"==typeof this.options?this.options(this):this.options,i)){if(Array.isArray(i)){var n={};for(const t of i)n[t]=t;i=n}const o=Object.keys(i);for(const n of o)s=document.createElement("option"),s.value=n,s.innerHTML=i[n],n===e&&(s.selected="selected"),t.appendChild(s)}}removeEvent(t,e,s){t.detachEvent?t.detachEvent("on"+e,s):t.removeEventListener(e,s)}customEvent(t,e){const s=t=>{e(this,t)};return this.handlers[t]=s,s}isEmpty(t){return null==t}getValue(t){let e;if(null!==t)if(["SELECT","INPUT","TEXTAREA"].includes(t.nodeName)){var s=t.type.toLowerCase();e="checkbox"===s?t.checked:"file"===s?t.files:"number"===s?Number(t[this.property]):"date"===s?t.valueAsDate:"time"===s?t.value:"datetime-local"===s?t.valueAsDate:t[this.property]}else e=t.innerHTML;return"function"==typeof this.write&&(e=this.write.call(this,e,t)),e}setValue(t,e=!1){if("function"==typeof this.read)this.read.call(this,t);else if(!this.isEmpty(this.elements))for(const s of this.elements)if(["SELECT","INPUT","TEXTAREA"].includes(s.nodeName)){const i=s.type.toLowerCase();this.isEmpty(t)?"checkbox"===i?s.checked=!1:"file"===i||""!==s[this.property]&&(s[this.property]=""):"checkbox"===i?s.checked===t&&!0!==e||(s.checked=t):"file"===i||("date"===i?"string"==typeof t?s.value=t.substr(0,10):t&&"function"==typeof t.toISOString&&(s.value=t.toISOString().substr(0,10)):"time"===i?"string"==typeof t?s.value=t.substr(11,5):t&&"function"==typeof t.toISOString&&(s.value=t.toISOString().substr(11,5)):"datetime-local"===i?"string"==typeof t?s.value=t.substr(0,16):t&&"function"==typeof t.toISOString&&(s.value=t.toISOString().substr(0,16)):s[this.property]===t&&!0!==e||(s[this.property]=t))}else this.isEmpty(t)?""!==s.innerHTML&&(s.innerHTML=""):s.innerHTML===t&&!0!==e||(s.innerHTML=t)}controlChanged(t){if(!0===this.twoWay){const e=this.getValue(t.target);void 0!==e&&(this.model[this.key]=e)}}modelChanged(t){const e=Object.keys(t);for(const s of e)this.key===s&&this.setValue(this.model[s],t.refresh)}apply(t,e){if(!0===t){if(!this.isEmpty(this.elements)){for(const t of this.elements)"SELECT"===t.nodeName&&this.addOptions(t,this.model[this.key]);this.setValue(this.model[this.key])}if(this.model._watch(this.key,this.modelHandler),!0===this.twoWay&&!this.isEmpty(this.elements))for(const t of this.elements)this.addEvent(t,this.event,this.controlHandler);const t=Object.keys(this.events);for(const e of t)if("function"==typeof this.events[e]){const t=this.customEvent(e,this.events[e]);for(const s of this.elements)this.addEvent(s,e,t)}"function"==typeof e&&e.call(this)}else{if(this.model._unwatch(this.key,this.modelHandler),!0===this.twoWay)for(const t of this.elements)this.removeEvent(t,this.event,this.controlHandler);const t=Object.keys(this.handlers);for(const e of t)for(const t of this.elements)this.removeEvent(t,e,this.handlers[e]);"function"==typeof e&&e(this)}}}window.bimo=window.bimo||{},window.bimo.Bind=Bind;class Binder{constructor(t={}){this.container=this.getContainer(t.container),this.model=t.model||{},this.binds={},this.init(this.container,this.model,t.config,t.defaults)}init(t,e,s,i={twoWay:!0,event:"change",property:"value"}){if(t&&(this.container=this.getContainer(t)),this.model=e,s){const t=Object.keys(s);for(const e of t)if(!0===Array.isArray(s[e])){this.binds[e]=[];for(const t of s[e]){var n=new window.bimo.Bind({container:this.container,model:this.model,key:e,config:t,defaults:i});this.binds[e].push(n)}}else this.binds[e]=new window.bimo.Bind({container:this.container,model:this.model,key:e,config:s[e],defaults:i})}}getContainer(t){let e=t;if(null==e)e=document;else if("string"==typeof t&&(e=document.querySelector(e),null===e))throw new Error(['"',t,'" container selector not found!']);return e}bind(t){const e=Object.keys(this.binds);for(const t of e)try{if(Array.isArray(this.binds[t]))for(const e of this.binds[t])e.apply(!0);else this.binds[t].apply(!0)}catch(e){console.error(t,e)}"function"==typeof t&&t.call(this)}unbind(t){const e=Object.keys(this.binds);for(const t of e)try{if(Array.isArray(this.binds[t]))for(const e of this.binds[t])e.apply(!1);else this.binds[t].apply(!1)}catch(e){console.error(t,e)}"function"==typeof t&&t.call(this)}}window.bimo.Binder=Binder;